"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e){var n=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"render",value:function(t){var n=e('<div class="alert alert-'+(t.type?t.type:"danger")+' alert-dismissible fade show" role="alert">\n                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n                <strong>'+(t.name?t.name+":":"")+"</strong>\n                "+t.message+"\n            </div>");e("#alerts").append(n),setTimeout(function(){return n.remove()},3e3)}}]),t}();t.todo=t.todo||{},t.todo.Alert=n}(window,jQuery);_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t){var e=function(){function t(){_classCallCheck(this,t),this.picker={$root:this,callback:{}};var e=this.picker;$("#dateTimePicker").AnyPicker({onInit:function(){e.$root=this},mode:"datetime",theme:"iOS",rowsNavigation:"scroller",onSetOutput:function(t,n){e.callback(n.date)}})}return _createClass(t,[{key:"open",value:function(t){this.picker.$root.showOrHidePicker(),this.picker.callback=t}}]),t}();t.todo=t.todo||{},t.todo.DateTimePicker=e}(window);var Mediator={subscribers:{any:[]},subscribe:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any";void 0===this.subscribers[e]&&(this.subscribers[e]=[]),this.subscribers[e].push(t)},unsubscribe:function(t,e){this.visitSubscribers("unsubscribe",t,e)},publish:function(t,e){this.visitSubscribers("publish",t,e)},visitSubscribers:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"any",i=this.subscribers[n],s=0;s<i.length;s+=1)"publish"===t?i[s](e):i[s]===e&&i.splice(s,1)}},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t){var e=function(){function t(e){_classCallCheck(this,t),this.scrollerContainer=document.querySelectorAll(e)}return _createClass(t,[{key:"render",value:function(){this.scrollerContainer.forEach(function(t){new PerfectScrollbar(t)})}}]),t}();t.todo=t.todo||{},t.todo.Scroller=e}(window),function(t,e){t.todo=t.todo||{},t.todo.Spinner=function(t){var n=e(t);return{toggle:function(t){"show"===t?n.show():n.hide()}}}}(window,jQuery);_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e,n){var i=function(){function t(e,n,i){_classCallCheck(this,t),this.model=e,this.listView=n,this.taskView=i,this.listActive="",this.spinner=todo.Spinner("#spinner"),this.alert=new todo.Alert,this.scroller=new todo.Scroller(".js-scroller"),this.dateTimePicker=new todo.DateTimePicker,Mediator.subscribe(this.listView.render,"list"),Mediator.subscribe(this.taskView.render,"task"),Mediator.subscribe(this.listView.listActive,"listActive"),Mediator.subscribe(this.spinner.toggle,"spinner"),Mediator.subscribe(this.alert.render,"alert"),this.scroller.render(),this.model.findAll(),this.bind()}return _createClass(t,[{key:"bind",value:function(){this.listView.$root.on("click","a",this._bindListItemClick.bind(this)),e("#addNewListForm").on("submit",this._bindNewListSubmit.bind(this)),e("#addNewTaskForm").on("submit",this._bindNewTaskSubmit.bind(this)),e("#todoTasks").on("click",this._bindTaskItemClick.bind(this)),e("#searchList").on("keyup",this._bindSearchList.bind(this)),e("#searchTask").on("keyup",this._bindSearchTask.bind(this)),e("#sortByDone").on("click",this._bindSortByDone.bind(this))}},{key:"_bindListItemClick",value:function(t){var n=e(t.currentTarget),i=n.closest(".js-list-parent").data("listId")||"";n.hasClass("js-set")?(this.listActive=i,Mediator.publish(this.model.getTasks(parseInt(this.listActive)),"task"),Mediator.publish(this.listActive,"listActive")):n.hasClass("js-edit")?this._editList(i):n.hasClass("js-remove")&&this.model.remove(i)}},{key:"_editList",value:function(t){var e=this,n=this.listView.$root.find("#editList"+t);n.addClass("openForm"),this.listView.toggleEditList(n),n.on("submit",function(i){i.preventDefault(),n.off("submit"),n.removeClass("openForm"),e.listView.toggleEditList(n),e.model.updateList(t,i.target.elements[0].value)}),n.on("focusout",function(t){n.removeClass("openForm"),e.listView.toggleEditList(n),n.off("focusout")})}},{key:"_bindNewListSubmit",value:function(t){t.preventDefault(),this.model.create(t.target),e("#newToDoList").val("")}},{key:"_bindTaskItemClick",value:function(t){var n=this,i=e(t.target),s=i.closest(".js-task-parent").data("taskId");i.hasClass("js-datetime")?this.dateTimePicker.open(function(t){n.model.updateTask(n.listActive,s,{field:"deadline",value:moment(t).valueOf()})}):i.hasClass("js-done")?this.model.updateTask(this.listActive,s,{field:"done",value:!i.find("input").prop("checked")}):e(t.target).closest(".js-edit").length?this._editTask(s):e(t.target).closest(".js-remove").length&&this.model.removeTask(this.listActive,s)}},{key:"_bindNewTaskSubmit",value:function(t){t.preventDefault(),this.model.update(t.target,this.listActive),e("#newToDoTask").val("")}},{key:"_editTask",value:function(t){var n=this,i=e("#editTask"+t);i.addClass("openForm"),this.taskView.toggleEditTask(i),i.on("submit",function(e){e.preventDefault(),i.off("submit"),i.removeClass("openForm"),n.taskView.toggleEditTask(i),n.model.updateTask(n.listActive,t,{field:"description",value:e.target.elements[0].value})}),i.on("focusout",function(t){i.removeClass("openForm"),n.taskView.toggleEditTask(i),i.off("focusout")})}},{key:"_bindSearchList",value:function(t){var e=n.trim(t.target.value).toLowerCase();e.length>0?Mediator.publish(this.model.lists.filter(function(t){return-1!==t.title.toLowerCase().indexOf(e)}),"list"):Mediator.publish(this.model.lists,"list")}},{key:"_bindSearchTask",value:function(t){if(this.listActive){var e=n.trim(t.target.value).toLowerCase();e.length>0?Mediator.publish(this.model.getTasks(this.listActive).filter(function(t){return-1!==t.description.toLowerCase().indexOf(e)}),"task"):Mediator.publish(this.model.getTasks(this.listActive),"task")}}},{key:"_bindSortByDone",value:function(t){if(this.listActive){var n=e("#sortByDoneIcon");n.is(":visible")?(n.hide(),Mediator.publish(this.model.getTasks(this.listActive),"task")):(n.show(),Mediator.publish(this.model.getTasks(this.listActive).filter(function(t){return!1===t.done}),"task"))}}}]),t}();t.todo=t.todo||{},t.todo.Controller=i}(window,jQuery,_);_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e,n){var i=function(){function t(){_classCallCheck(this,t),this.$root=t.getRoot()}return _createClass(t,null,[{key:"getRoot",value:function(){return e("#todoList")}}]),_createClass(t,[{key:"toggleEditList",value:function(t){t.hasClass("openForm")?(t.find("input").prop("type","text").focus(),t.find("span").hide()):(t.find("input").prop("type","hidden"),t.find("span").show())}},{key:"render",value:function(e){var i=t.getRoot();i.html(""),n.forEach(e,function(t){i.append('<li class="list-group-item js-list-parent" href="javascript:void(0)" data-list-id="'+t.id+'">\n                    <div class="d-flex w-100 justify-content-between">\n                        <form id="editList'+t.id+'">\n                            <span><a class="js-set" href="javascript:void(0)">'+t.title+'</a></span>\n                            <input class="form-control" type="hidden" name="lists['+t.id+']" value="'+t.title+'">                        \n                        </form>\n                        <span>\n                            <a class="js-edit" href="javascript:void(0)"><span class="dripicons-pencil"></span></a>\n                            <a class="js-remove" href="javascript:void(0)"><span class="dripicons-cross"></span></a>\n                        </span>\n                    </div>\n                </li>')})}},{key:"listActive",value:function(n){t.getRoot().find("[data-list-id]").each(function(t,i){var s=e(i);s.removeClass("active"),parseInt(s.data("listId"))===n&&s.addClass("active")})}}]),t}();t.todo=t.todo||{},t.todo.ListView=i}(window,jQuery,_);_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e){var n=function(){function t(e){_classCallCheck(this,t),this.store=e,this.lists={}}return _createClass(t,[{key:"findAll",value:function(){var t=this;this.store.find().then(function(n){return Promise.all(n.map(function(n){return t.store.find(n).then(function(t){return e.merge(t,{id:n})})}))},function(t){return Mediator.publish({message:t},"alert")}).then(function(e){t.lists=e,Mediator.publish(t.lists,"list")})}},{key:"findOne",value:function(t){this.store.find(t).then(function(t){return Mediator.publish(t,"task")},function(t){return Mediator.publish({message:t},"alert")})}},{key:"create",value:function(t){var e=this,n=Date.now(),i={title:t.elements[0].value,created:(new Date).toString(),tasks:[]};this.store.create(n,i).then(function(t){return t.created?e.findAll():Mediator.publish(t.error,"alert")},function(t){return Mediator.publish({message:t},"alert")})}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getList(e);n.tasks.push({description:t.elements[0].value,done:!1,deadline:Date.now()}),this.store.update(e,n).then(function(t){return t.updated?Mediator.publish(n.tasks,"task"):Mediator.publish(t.error,"alert")},function(t){return Mediator.publish({message:t},"alert")})}},{key:"remove",value:function(t){var e=this;this.store.remove(t).then(function(t){return t.deleted?e.findAll():Mediator.publish(t.error,"alert")},function(t){return Mediator.publish({message:t},"alert")})}},{key:"getList",value:function(t){return this.lists.find(function(e){return e.id==t})}},{key:"updateList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments[1],i=this.getList(e);i.title=n,this.store.update(e,i).then(function(e){return e.updated?t.findAll():Mediator.publish(e.error,"alert")},function(t){return Mediator.publish({message:t},"alert")})}},{key:"getTasks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.lists.reduce(function(e,n){return n.id==t?n.tasks:e},[])}},{key:"updateTask",value:function(t,e,n){var i=this.lists.find(function(e){return e.id==t});i.tasks[e][n.field]=n.value,this.store.update(t,i).then(function(t){return t.updated?Mediator.publish(i.tasks,"task"):Mediator.publish(t.error,"alert")},function(t){return Mediator.publish({message:t},"alert")})}},{key:"removeTask",value:function(t,e){var n=this.getList(t);n.tasks.splice(e,1),this.store.update(t,n).then(function(t){return t.updated?Mediator.publish(n.tasks,"task"):Mediator.publish(t.error,"alert")},function(t){return Mediator.publish({message:t},"alert")})}}]),t}();t.todo=t.todo||{},t.todo.Model=n}(window,_);_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t){var e=function(){function t(){_classCallCheck(this,t),this.endpoint="https://enigmatic-temple-67838.herokuapp.com/todo",this.STATE_READY=4}return _createClass(t,[{key:"find",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.send(t)}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(t,"POST",{todo:JSON.stringify(e)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(t,"PUT",{todo:JSON.stringify(e)})}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.send(t,"DELETE")}},{key:"send",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=this.endpoint+"/"+(0===t?"":t);return new Promise(function(t,o){var r=new XMLHttpRequest;Mediator.publish("show","spinner"),r.open(n,s,!0),r.setRequestHeader("Content-Type","application/json; charset=utf-8"),r.onload=function(){200===r.status?t(JSON.parse(r.response)):o(Error(r.statusText))},r.onreadystatechange=function(){r.readyState===e.STATE_READY&&Mediator.publish("hide","spinner")},r.onerror=function(){return o(Error("Network error"))},r.send(JSON.stringify(i))})}}]),t}();t.todo=t.todo||{},t.todo.Store=e}(window);_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e,n){var i=function(){function t(){_classCallCheck(this,t),this.$root=t.getRoot()}return _createClass(t,null,[{key:"getRoot",value:function(){return e("#todoTasks")}}]),_createClass(t,[{key:"toggleEditTask",value:function(t){t.hasClass("openForm")?(t.find("input").prop("type","text").focus(),t.find("span").hide()):(t.find("input").prop("type","hidden"),t.find("span").show())}},{key:"render",value:function(e){var i=t.getRoot();i.html(""),0===e.length?i.append('<tr>\n                    <td class="text-center" colspan="3">No Tasks!</td>\n                </tr>'):n.forEach(e,function(t,e){i.append('<tr class="js-task-parent" data-task-id="'+e+'">\n                        <td>\n                            <div class="d-flex w-100 justify-content-between align-items-center">\n                                <form id="editTask'+e+'">\n                                    <span>'+t.description+'</span>\n                                    <input class="form-control" type="hidden" name="tasks['+e+']" value="'+t.description+'">\n                                </form>\n                                <span>\n                                    <a class="js-edit" href="javascript:void(0)"><span class="dripicons-pencil"></span></a>\n                                    <a class="js-remove" href="javascript:void(0)"><span class="dripicons-cross"></span></a>\n                                </span>\n                            </div>\n                        </td>\n                        <td class="js-datetime" data-timestamp="'+t.deadline+'">'+(t.deadline?moment(t.deadline).format("DD.MM.YYYY HH:mm"):"---")+'</td>\n                        <td>\n                            <label class="js-done custom-control custom-checkbox">\n                                <input type="checkbox" class="custom-control-input" '+(t.done?"checked":"")+'>\n                                <span class="custom-control-indicator"></span>\n                            </label>\n                        </td>\n                    </tr>')})}}]),t}();t.todo=t.todo||{},t.todo.TaskView=i}(window,jQuery,_),function(){var t=new todo.Store,e=new todo.Model(t),n=new todo.ListView,i=new todo.TaskView;new todo.Controller(e,n,i)}();